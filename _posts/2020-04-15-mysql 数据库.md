---
title: mysql数据库
description: 数据库
tags: Java、mysql
---


索引
 -
1. 索引
    - 是一种数据结构
        - 二叉树
        - 红黑树
        - hash表
        - B-Tree
        - B+Tree ：多叉平衡树
            - 有序、叶子结点才有data --> 查找速度稳定
    - 联合索引
        - 最左前缀原理：多个索引字段，先按照第一个字段排序，再按照第二个字段排序，以此类推...
        - 查询条件不包含前边的索引字段，不使用索引：例如name,age,sex 使用name,age使用了索引，使用sex没有使用索引
            
            
2. 引擎
    - 存储引擎是表级的，一个数据库内不同的表可以使用不同的引擎
    - innordb：聚集索引
        - B+Tree 
        - 聚集索引：叶子节点保存data消息体
        - 为什么必须有主键：不创建主键，数据库默认一个字段作为主键，索引为B+Tree，需要有一个值来组成，（如果没创建也没有符合要求的，创建一个隐藏列）
        - 为什么主键使用自增整数：好比较，有序，占内存小
        - 为什么非主键索引，叶子节点存储的主键值：
    - MyISAM：非聚集索引
        - B+Tree
        - 非聚集索引：叶子结点存储的data地址，数据在文件中
3. 三范式
    - 列不可分
    - 每个表只描述一件事
    - 只有主键可以依赖传递

4. 数据库的事务
    - 原子性：要么都成功，要么都失败
    - 一致性：更新后所有查询结果都是一样的
    - 隔离性：每个事务之间没有依赖
    - 持久性：更新后保存
        


执行顺序和优化
-    
10. 优化
    
       
11. 数据库执行组件
    - 连接器
    - 分析器
        - 将sql 编译成一个条件树，解析完成后绑定的过程中会检查sql的合法性
    - 优化器
        - 商业数据库最核心的地方
    - 执行器              
    
12. sql关键词的执行顺序
    1. from 
    2. join 
    3. on 
    4. where 
    5. group by(开始使用select中的别名，后面的语句中都可以使用)
    6. avg,sum.... 
    7. having 
    8. select 
    9. distinct 
    10. order by
    11. limit 

14. mysql最大并发数
    - 可以设置

15. 优化
    - 性能监控：查看执行顺序和每个步骤的时间
        1. select @@profiling 打开
        2. 执行sql
        3. show profile 查看查询总时间
        4. show profile for query 1(queryId); 查看每个步骤的时间 
        5. show cpu for query 1; 查看每个步骤的cpu
        - ----------------------------------------------
        6. profile不维护了 ，使用performace_schema
    - schema和数据类型 优化
        - 选择合理的数据类型，尽可能占用小的空间  
        - 尽量不使用null，null 占用空间
        
    - 对索引的使用
        - 数据占空间尽可能小：使用int等
        - or/in/<>/!= 不使用索引
        - exist代替in
        - 尽量使用索引

16. 总结
        
        关于索引优化原则，可以做如下总结。
        
        全值匹配心上人（这是基本原则），最左前缀要遵行（联合索引一般都围绕最左前缀优化）；
        
        带头大哥活才行（联合索引从最左边字段开始使用），中间兄弟规矩行（不能跳过中间的字段，跳过后索引无效）；
        
        索引列上少计算（索引列上尽量不要进行计算），范围之后全完蛋（where后面使用范围查询的之后的索引无效）；
        
        like百分最右写（%号写最右边，写左边会导致索引失效），覆盖索引别写星（尽量避免select*这样的语句，能写索引列最好）；
        
        空值不等还有or，索引失效最无情（is null，is not null，!=，<>，or会导致索引无效）；
        
        关于索引优化原则，不同的sql版本会有不同，并且需要结合explain的各项参数分析，需要不断体会，
        
        explain博大精深。

数据库锁
-
- 共享锁
    - share model
- 排它锁
    - for update
    
隔离级别
-
- read uncommit：读未提交   脏读、幻读、不可重复读
- read commit：读提交   幻读、不可重复读
- repeatable read ：重复读  幻读
- serialalizable：串行化  

- 脏读：读取了未提交的数据
- 重复读：前后两次读同一条数据，结果不一样
- 幻读：前后两次同样的条件，读到的数据行数不一样

